[tox]
minversion = 3.24.5
isolated_build = True
envlist = 
    py{3.10,3.11,3.12,3.13,3.14}-sphinx{70,71,72,73,74}-theme{200,300}-sphinxextension{off,on}
    py{3.10,3.11,3.12,3.13,3.14}-sphinx{80,81}-theme{300}-sphinxextension{off,on}
    # py{3.11,3.12,3.13,3.14}-sphinx{90}-theme{200,300}-sphinxextension{off,on}
    docs
    flake8

[testenv]
deps = 
    sphinx70: sphinx~=7.0.0
    sphinx71: sphinx~=7.1.0
    sphinx72: sphinx~=7.2.0
    sphinx73: sphinx~=7.3.0
    sphinx73: defusedxml
    sphinx74: sphinx~=7.4.0
    sphinx80: sphinx~=8.0.0
    sphinx81: sphinx~=8.1.0
    # sphinx90: sphinx~=9.0.0
    theme200: sphinx_rtd_theme~=2.0.0
    theme300: sphinx_rtd_theme~=3.0.0
    sphinxextensionon: readthedocs-sphinx-ext
    pytest
    pytest-mock
    coverage
setenv =
    COVERAGE_FILE={envtmpdir}/{envname}_coverage
commands =
    coverage run -m pytest -o cache_dir={envtmpdir}/pytest_cache --cache-clear
    coverage report

[coverage:run]
branch = True
source_pkgs = subprojecttoctree

[coverage:path]
source =
    subprojecttoctree/

[coverage:report]
exclude_lines =
    pragma: no cover
show_missing = True
omit = subprojecttoctree/__version__.py

[testenv:docs]
basepython = python3
changedir = docs
deps =
    sphinx~=7.0.0
    sphinx_rtd_theme~=2.0.0
    sphinx-issues~=5.0.0
commands = sphinx-build -W -b html -d {envtmpdir}/doctrees ./source {envtmpdir}/html

[testenv:flake8]
basepython = python3
deps = flake8
skip_install = true
commands = flake8 subprojecttoctree/ test/ docs/source/conf.py

[testenv:black]
basepython = python3
deps = black
skip_install = true
commands = black --check .